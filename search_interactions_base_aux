CREATE VIEW 	business_intelligence.search_interactions_base_aux AS

SELECT			public.offer_search_v1.search_id,
				public.offer_search_v1.guest_id,
				public.offer_search_v1.tracking_id,
				public.offer_search_v1.country,
				public.offer_search_v1.city,
				public.offer_search_v1.sort_by,
				DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second') as searched_at,
				EXTRACT(year from DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second')) as searched_at_year,
				EXTRACT(month from DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second')) as searched_at_month,
				main.uniplaces_week.week_up as searched_at_week,
				public.offer_search_v1.experiment_id,
				public.offer_search_v1.free_text_search,
				public.offer_search_v1.move_in,
				public.offer_search_v1.move_out,
				public.offer_search_v1.budget_minimum,
				public.offer_search_v1.budget_maximum,
				public.offer_search_v1.rent_types,
				public.offer_search_v1.number_of_bedrooms,
				public.offer_search_v1.number_of_bathrooms,
				public.offer_search_v1.accommodation_types,
				public.offer_search_v1.features,
				public.offer_search_v1.suitable_for_erasmus_students,
				public.offer_search_v1.suitable_for_domestic_students,
				public.offer_search_v1.suitable_for_professional_placement,
				public.offer_search_v1.gender_restrictions,
				public.offer_search_v1.occupancy_restrictions,
				public.offer_search_v1.bills_included


FROM			public.offer_search_v1
LEFT JOIN		main.uniplaces_week
					ON main.uniplaces_week.date_week = DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second')
WHERE 			DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second') >= '2018-09-01'
GROUP BY		public.offer_search_v1.search_id,
				public.offer_search_v1.guest_id,
				public.offer_search_v1.tracking_id,
				public.offer_search_v1.country,
				public.offer_search_v1.city,
				public.offer_search_v1.sort_by,
				DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second'),
				EXTRACT(year from DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second')),
				EXTRACT(month from DATE(TIMESTAMP 'epoch' + public.offer_search_v1.created_at/1000 * INTERVAL '1 second')),
				main.uniplaces_week.week_up,
				public.offer_search_v1.experiment_id,
				public.offer_search_v1.free_text_search,
				public.offer_search_v1.move_in,
				public.offer_search_v1.move_out,
				public.offer_search_v1.budget_minimum,
				public.offer_search_v1.budget_maximum,
				public.offer_search_v1.rent_types,
				public.offer_search_v1.number_of_bedrooms,
				public.offer_search_v1.number_of_bathrooms,
				public.offer_search_v1.accommodation_types,
				public.offer_search_v1.features,
				public.offer_search_v1.suitable_for_erasmus_students,
				public.offer_search_v1.suitable_for_domestic_students,
				public.offer_search_v1.suitable_for_professional_placement,
				public.offer_search_v1.gender_restrictions,
				public.offer_search_v1.occupancy_restrictions,
				public.offer_search_v1.bills_included
